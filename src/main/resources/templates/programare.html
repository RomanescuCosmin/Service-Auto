<!DOCTYPE html>
<html lang="ro" th:replace="~{fragments/layout :: layout(~{::title}, ~{::section})}"
      xmlns:x-transition="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Programare</title>
</head>
<body class="bg-white">
<section x-data="{ open:null, showContent:false }"
         x-init="setTimeout(()=>showContent=true,100)"
         class="relative overflow-hidden bg-gradient-to-b from-slate-50 via-white to-orange-50/40">
    <div aria-hidden="true" class="pointer-events-none absolute -left-32 top-20 h-80 w-80 rounded-full bg-orange-200/40 blur-3xl"></div>
    <div aria-hidden="true" class="pointer-events-none absolute -right-24 bottom-20 h-72 w-72 rounded-full bg-slate-200/60 blur-3xl"></div>

    <div x-show="showContent"
         x-transition:enter="transition ease-out duration-700"
         x-transition:enter-start="opacity-0 translate-y-4"
         x-transition:enter-end="opacity-100 translate-y-0">

        <header class="max-w-7xl mx-auto px-6 pt-10">
            <div class="rounded-[32px] border border-slate-200/70 bg-white/80 shadow-sm backdrop-blur">
                <div class="grid gap-8 px-6 py-8 md:grid-cols-[1.25fr_0.75fr] md:items-center">
                    <div>
                        <p class="text-sm font-semibold uppercase tracking-[0.2em] text-orange-500">Programare online</p>
                        <h1 class="mt-3 text-4xl md:text-5xl font-extrabold tracking-tight text-slate-900">
                            Programare <span class="text-orange-500">Service Auto</span>
                        </h1>
                        <p class="mt-3 text-slate-600">
                            Programează-ți vizita în câțiva pași. Pentru întrebări rapide, sună la
                            <a class="font-semibold text-slate-900 hover:underline" href="tel:0731348340">0731 348 340</a>.
                        </p>
                        <div class="mt-6 flex flex-wrap gap-3">
                            <a th:href="@{/contact}"
                               class="inline-flex items-center gap-2 rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800">
                                Ai întrebări?
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 5l7 7-7 7"/>
                                    <path d="M5 12h11"/>
                                </svg>
                            </a>
                            <span class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700">
                                <svg class="h-4 w-4 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.12.81.3 1.6.54 2.36a2 2 0 0 1-.45 2.11L8 9a16 16 0 0 0 7 7l.81-1.09a2 2 0 0 1 2.11-.45c.76.24 1.55.42 2.36.54A2 2 0 0 1 22 16.92z"/>
                                </svg>
                                Sună acum
                            </span>
                        </div>
                    </div>

                    <div class="rounded-2xl border border-orange-100 bg-gradient-to-br from-orange-50 via-white to-white p-5 shadow-sm">
                        <h2 class="text-lg font-semibold text-slate-900">Cum funcționează?</h2>
                        <p class="mt-2 text-sm text-slate-600">
                            Completezi datele, alegi mașina și selectezi intervalul dorit. Confirmarea vine rapid pe email.
                        </p>
                        <ol class="mt-4 space-y-3">
                            <li class="flex items-center gap-3 rounded-xl bg-white px-3 py-2 text-sm font-semibold text-slate-700 shadow-sm">
                                <span class="grid h-7 w-7 place-items-center rounded-full bg-orange-500 text-white text-xs font-bold">1</span>
                                Contact & date personale
                            </li>
                            <li class="flex items-center gap-3 rounded-xl bg-white px-3 py-2 text-sm font-semibold text-slate-700 shadow-sm">
                                <span class="grid h-7 w-7 place-items-center rounded-full bg-orange-500 text-white text-xs font-bold">2</span>
                                Selectare mașină
                            </li>
                            <li class="flex items-center gap-3 rounded-xl bg-white px-3 py-2 text-sm font-semibold text-slate-700 shadow-sm">
                                <span class="grid h-7 w-7 place-items-center rounded-full bg-orange-500 text-white text-xs font-bold">3</span>
                                Interval preferat
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </header>

        <!-- alerte -->
        <div th:replace="~{fragments/succes-message}"></div>
        <div th:replace="~{fragments/notification-error}"></div>

        <div class="max-w-7xl mx-auto px-6 py-10">
            <form th:action="@{/programare}"
                  th:object="${programareDto}"
                  method="post"
                  enctype="multipart/form-data" class="mt-8 space-y-8">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <div class="grid gap-8 lg:grid-cols-3">


                    <fieldset class="relative overflow-hidden rounded-3xl bg-white shadow-xl ring-1 ring-slate-200/70">
                        <legend class="sr-only">Informații Contact</legend>
                        <div class="relative px-6 pt-6 pb-5 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 text-white">
                            <div class="flex items-center gap-3">
                                <span class="grid h-11 w-11 place-items-center rounded-2xl bg-white/15 ring-1 ring-white/30">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="8" r="3.5"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                                    </svg>
                                </span>
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-[0.25em] text-orange-200">Pasul 1</p>
                                    <h2 class="text-xl font-semibold">Informații Contact</h2>
                                </div>
                            </div>
                        </div>

                        <div class="px-6 pb-7 pt-6 space-y-5 min-h-[360px] bg-gradient-to-b from-white to-slate-50/60">
                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Nume*</span>
                                <input th:field="*{nume}" placeholder="Nume complet"
                                       required class="w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3.5 text-sm
                           outline-none shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </label>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Telefon*</span>
                                <input th:field="*{telefon}" type="tel" inputmode="tel" placeholder="07xx xxx xxx"
                                       required
                                       class="w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3.5 text-sm
                           outline-none shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </label>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Email*</span>
                                <input th:field="*{email}" type="email" placeholder="ex: nume@email.ro" required
                                       class="w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3.5 text-sm
                           outline-none shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </label>
                        </div>
                    </fieldset>

                    <fieldset class="relative overflow-hidden rounded-3xl bg-white shadow-xl ring-1 ring-orange-100">
                        <legend class="sr-only">Informații Mașină</legend>
                        <div class="relative px-6 pt-6 pb-5 bg-gradient-to-r from-orange-500 via-amber-500 to-orange-400 text-white">
                            <div class="flex items-center gap-3">
                                <span class="grid h-11 w-11 place-items-center rounded-2xl bg-white/20 ring-1 ring-white/30">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 13l2-5a2 2 0 011.9-1.3h10.2A2 2 0 0120 8l2 5v4a2 2 0 01-2 2h-1a2 2 0 01-2-2H7a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                                        <circle cx="7" cy="17" r="1.5"/><circle cx="17" cy="17" r="1.5"/>
                                    </svg>
                                </span>
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-[0.25em] text-orange-100">Pasul 2</p>
                                    <h2 class="text-xl font-semibold">Informații Mașină</h2>
                                </div>
                            </div>
                        </div>

                        <div class="px-6 pb-7 pt-6 space-y-5 min-h-[360px] bg-gradient-to-b from-white to-orange-50/60">

                            <div class="relative">
                                <select id="marcaId" name="marcaId" th:field="*{marcaId}"
                                        class="w-full appearance-none rounded-2xl border border-slate-200 bg-white px-4 py-3.5 text-sm text-slate-800
                                       outline-none transition shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200 hover:bg-white pr-10">
                                    <option value="">-- Selectează marcă --</option>
                                    <option th:each="marca : ${marci}"
                                            th:value="${marca.id}"
                                            th:text="${marca.nume}"></option>
                                </select>
                                <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 opacity-70"
                                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                                          clip-rule="evenodd"/>
                                </svg>
                            </div>

                            <div th:replace="~{fragments/cascade-select :: cascadeSelect(
                                selectName='modelId',
                                defaultValue=${programareDto.modelId},
                                defaultText=${programareDto.modelNume},
                                cascadeId='marcaId',
                                cascadeUrl=@{/model/byMarca}
                            )}"></div>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Serie șasiu (VIN)</span>
                                <input th:field="*{serieSasiu}" placeholder="Serie șasiu"
                                       class="w-full rounded-2xl border border-slate-200 bg-white px-4 py-3.5 text-sm
                           outline-none shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </label>
                        </div>
                    </fieldset>


                    <fieldset class="relative overflow-hidden rounded-3xl bg-white shadow-xl ring-1 ring-slate-200/70">
                        <legend class="sr-only">Programare</legend>
                        <div class="relative px-6 pt-6 pb-5 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-900 text-white">
                            <div class="flex items-center gap-3">
                                <span class="grid h-11 w-11 place-items-center rounded-2xl bg-white/15 ring-1 ring-white/30">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2"/><path d="M8 2v4M16 2v4M3 10h18"/>
                                    </svg>
                                </span>
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-[0.25em] text-orange-200">Pasul 3</p>
                                    <h2 class="text-xl font-semibold">Programare</h2>
                                </div>
                            </div>
                        </div>

                        <div class="px-6 pb-7 pt-6 space-y-5 min-h-[360px] bg-gradient-to-b from-white to-slate-50/60" x-data="schedulePicker($el)" x-init="initPicker()"
                             th:attr="data-booked-slots=${#strings.arrayJoin(bookedSlots, ',')}">
                            <input type="hidden" x-ref="dateField" th:field="*{dataProgramare}">
                            <input type="hidden" x-ref="hourField" th:field="*{oraProgramare}">
                            <input type="hidden" x-ref="minuteField" th:field="*{minutProgramare}">

                            <div class="grid grid-cols-2 gap-4">
                                <div class="rounded-2xl border border-slate-200 bg-white px-4 py-3.5 text-sm shadow-sm">
                                    <span class="block text-xs font-semibold text-slate-700 mb-1">Data selectată</span>
                                    <span class="text-slate-700" x-text="selectedDate || 'Selectează data'"></span>
                                </div>

                                <div class="rounded-2xl border border-slate-200 bg-white px-4 py-3.5 text-sm shadow-sm">
                                    <span class="block text-xs font-semibold text-slate-700 mb-1">Interval selectat</span>
                                    <span class="text-slate-700" x-text="selectedTime || 'Selectează ora'"></span>
                                </div>
                            </div>

                            <button type="button" @click="openModal()"
                                    class="inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 shadow-sm hover:border-orange-500 hover:bg-orange-50 transition">
                                <svg class="h-4 w-4 text-orange-500" viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2"/>
                                    <path d="M8 2v4M16 2v4M3 10h18"/>
                                </svg>
                                Alege data și intervalul orar
                            </button>

                            <p class="text-xs text-slate-500">Program: 08:00 - 18:00 · Intervale de 30 minute.</p>

                            <div x-show="modalOpen" x-cloak
                                 class="fixed inset-0 z-50 flex min-h-screen items-center justify-center bg-slate-900/50 px-4 py-6">
                                <div class="w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl ring-1 ring-slate-200/70"
                                     x-transition @click.away="closeModal()" @keydown.escape.window="closeModal()">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg font-semibold text-slate-900">Alege data și ora</h3>
                                        <button type="button" @click="closeModal()"
                                                class="rounded-lg p-2 text-slate-500 hover:bg-slate-100">
                                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                                                 stroke="currentColor" stroke-width="2">
                                                <path d="M6 6l12 12M6 18L18 6"/>
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="mt-4 space-y-4">
                                        <label class="block">
                                            <span class="block text-xs font-semibold text-slate-700 mb-1">Data programării</span>
                                            <input type="date" x-model="selectedDate" @change="onDateChange()"
                                                   :min="minDate"
                                                   class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                               outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                                        </label>

                                        <div>
                                            <span class="block text-xs font-semibold text-slate-700 mb-2">Interval orar</span>
                                            <div class="grid grid-cols-3 gap-2 sm:grid-cols-4">
                                                <template x-for="time in times" :key="time">
                                                    <button type="button"
                                                            :disabled="slotDisabled(selectedDate, time)"
                                                            :class="slotClass(selectedDate, time)"
                                                            @click="selectTime(time)">
                                                        <span x-text="time"></span>
                                                        <span x-show="isBooked(selectedDate, time)"
                                                              class="block text-[10px] font-semibold uppercase tracking-wide">Ocupat</span>
                                                    </button>
                                                </template>
                                            </div>
                                            <p class="mt-2 text-xs text-slate-500" x-show="!selectedDate">
                                                Alege întâi o dată pentru a vedea intervalele disponibile.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Observații</span>
                                <textarea th:field="*{observatii}" rows="3"
                                          class="w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3.5 text-sm
                              outline-none shadow-sm focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                                          placeholder="Detalii suplimentare (ex: simptome, preferințe, etc.)"></textarea>
                            </label>
                        </div>

                        <div x-data="{ fileName: '' }">
                            <span class="block text-xs font-semibold text-slate-700 mb-1">Încarcă un fișier (opțional)</span>

                            <label for="fisier"
                                   class="flex items-center justify-between w-full rounded-2xl border border-slate-200 bg-white
                  px-4 py-3.5 text-sm cursor-pointer shadow-sm
                  hover:bg-white hover:border-orange-500 hover:ring-2 hover:ring-orange-200
                  transition duration-200">

                                <div class="flex items-center gap-3">
                                    <svg class="h-5 w-5 text-orange-500" fill="none" stroke="currentColor"
                                         stroke-width="2"
                                         viewBox="0 0 24 24">
                                        <path d="M12 5v14m7-7H5"/>
                                    </svg>

                                    <span x-text="fileName || 'Alege un fișier…'" class="text-slate-600"></span>
                                </div>

                                <span class="text-orange-600 font-semibold">Browse</span>
                            </label>

                            <input id="fisier" name="fisier" type="file"
                                   class="hidden"
                                   @change="fileName = $event.target.files[0]?.name ?? ''">

                            <p class="mt-1 text-xs text-slate-500">
                                Acceptă PDF, PNG, JPG. Maxim 50MB.
                            </p>
                        </div>

                    </fieldset>

                </div>

                <div class="grid lg:grid-cols-[1fr_auto] gap-6 items-start">
                    <p class="text-slate-600">
                        Notă: data selectată poate să nu fie disponibilă. Vei fi contactat pentru confirmare.
                    </p>

                    <div class="flex items-center gap-3">
                        <button type="submit"
                                class="inline-flex items-center gap-2 rounded-xl bg-orange-500 px-6 py-3
                    font-semibold text-white shadow-sm hover:bg-orange-600 hover:shadow-md">
                            Trimite
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14"/>
                                <path d="M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>
        </div>

    </div>
</section>

</body>
</html>
