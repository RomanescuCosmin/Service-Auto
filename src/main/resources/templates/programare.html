<!DOCTYPE html>
<html lang="ro" th:replace="~{fragments/layout :: layout(~{::title}, ~{::section})}"
      xmlns:x-transition="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>Programare</title>
</head>
<body class="bg-white">
<section x-data="{ open:null, showContent:false }"
         x-init="setTimeout(()=>showContent=true,100)" class="bg-white">

    <div x-show="showContent"
         x-transition:enter="transition ease-out duration-700"
         x-transition:enter-start="opacity-0 translate-y-4"
         x-transition:enter-end="opacity-100 translate-y-0">

        <header class="max-w-7xl mx-auto px-6 pt-10">
            <div class="flex items-center justify-between gap-4">
                <div>
                    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-slate-900">
                        Programare <span class="text-orange-500">Service Auto</span>
                    </h1>
                    <p class="mt-2 text-slate-700">
                        Pentru programare, sună la
                        <a class="font-semibold text-slate-900 hover:underline" href="tel:0731348340">0731 348 340</a>
                        sau completează formularul.
                    </p>
                </div>
                <a th:href="@{/contact}" class="hidden md:inline-flex items-center gap-2 rounded-xl bg-slate-900
                 px-4 py-2 font-semibold text-white hover:bg-slate-800">
                    Ai întrebări?
                    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 5l7 7-7 7"/><path d="M5 12h11"/>
                    </svg>
                </a>
            </div>

            <ol class="mt-8 grid grid-cols-3 gap-3">
                <li class="flex items-center gap-3">
                    <span class="grid h-8 w-8 place-items-center rounded-full bg-orange-500 text-white font-bold">1</span>
                    <span class="text-sm font-semibold text-slate-800">Contact</span>
                    <span class="mx-3 hidden lg:block h-0.5 flex-1 rounded bg-orange-200"></span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="grid h-8 w-8 place-items-center rounded-full bg-orange-500 text-white font-bold">2</span>
                    <span class="text-sm font-semibold text-slate-800">Mașină</span>
                    <span class="mx-3 hidden lg:block h-0.5 flex-1 rounded bg-orange-200"></span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="grid h-8 w-8 place-items-center rounded-full bg-orange-500 text-white font-bold">3</span>
                    <span class="text-sm font-semibold text-slate-800">Programare</span>
                </li>
            </ol>
        </header>

        <div class="max-w-7xl mx-auto px-6 py-10">
            <form th:action="@{/programare/list}"
                  th:object="${programareDto}"
                  method="post"
                  enctype="multipart/form-data" class="space-y-8">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div class="grid lg:grid-cols-3 gap-8">


                    <fieldset class="rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm">
                        <legend class="px-5 pt-5 flex items-center gap-3 text-lg font-semibold text-slate-900">
                <span class="grid h-9 w-9 place-items-center rounded-xl bg-orange-500/15 text-orange-600 ring-1 ring-orange-400/30">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="3.5"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                    </svg>
                </span>
                            Informații Contact
                        </legend>

                        <div class="px-5 pb-6 pt-4 space-y-4">
                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Nume*</span>
                                <input th:field="*{nume}" placeholder="Nume complet"
                                       required class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                           outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                            </label>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Telefon*</span>
                                <input th:field="*{telefon}" type="tel" inputmode="tel" placeholder="07xx xxx xxx" required
                                       class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                           outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                            </label>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Email*</span>
                                <input th:field="*{email}" type="email" placeholder="ex: nume@email.ro" required
                                       class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                           outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                            </label>
                        </div>
                    </fieldset>

                    <fieldset class="rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm">
                        <legend class="px-5 pt-5 flex items-center gap-3 text-lg font-semibold text-slate-900">
                <span class="grid h-9 w-9 place-items-center rounded-xl bg-orange-500/15 text-orange-600 ring-1 ring-orange-400/30">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 13l2-5a2 2 0 011.9-1.3h10.2A2 2 0 0120 8l2 5v4a2 2 0 01-2 2h-1a2 2 0 01-2-2H7a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                        <circle cx="7" cy="17" r="1.5"/><circle cx="17" cy="17" r="1.5"/>
                    </svg>
                </span>
                            Informații Mașină
                        </legend>

                        <div class="px-5 pb-6 pt-4 space-y-4">

                            <div class="select-wrapper">
                                <select id="marcaId" name="marcaId" th:field="*{marcaId}" class="modern-select">
                                    <option value="">-- Selectează marcă --</option>
                                    <option th:each="marca : ${marci}"
                                            th:value="${marca.id}"
                                            th:text="${marca.nume}"></option>
                                </select>
                            </div>

                            <div th:replace="~{fragments/cascade-select :: cascadeSelect(
                                selectName='modelId',
                                defaultValue=${programareDto.modelId},
                                defaultText=${programareDto.modelNume},
                                cascadeId='marcaId',
                                cascadeUrl=@{/programare/byMarca}
                            )}"></div>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Serie șasiu (VIN)</span>
                                <input th:field="*{serieSasiu}" placeholder="Serie șasiu"
                                       class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                           outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                            </label>
                        </div>
                    </fieldset>


                    <fieldset class="rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm">
                        <legend class="px-5 pt-5 flex items-center gap-3 text-lg font-semibold text-slate-900">
                <span class="grid h-9 w-9 place-items-center rounded-xl bg-orange-500/15 text-orange-600 ring-1 ring-orange-400/30">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2"/><path d="M8 2v4M16 2v4M3 10h18"/>
                    </svg>
                </span>
                            Programare
                        </legend>

                        <div class="px-5 pb-6 pt-4 space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <label class="block">
                                    <span class="block text-xs font-semibold text-slate-700 mb-1">Data</span>
                                    <input th:field="*{dataProgramare}" type="date"
                                           class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                               outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">
                                </label>

                                <label class="block" x-data="{
                                            combined: '',
                                            init() {
                                              // pre-populează din valorile deja setate în DTO (dacă vin din server)
                                              const h = this.$refs.h.value;
                                              const m = this.$refs.m.value;
                                              if (h || m) {
                                                this.combined = String(h||'').padStart(2,'0') + ':' + String(m||'').padStart(2,'0');
                                              }
                                            },
                                            sync() {
                                              if (!this.combined) {
                                                this.$refs.h.value = '';
                                                this.$refs.m.value = '';
                                                return;
                                              }
                                              const [hh, mm] = this.combined.split(':');
                                              // setăm în hidden; Spring va binda în Integer/Long fără probleme
                                              this.$refs.h.value = parseInt(hh ?? '0', 10);
                                              this.$refs.m.value = parseInt(mm ?? '0', 10);
                                            }
                                          }" x-init="init()">
                                    <span class="block text-xs font-semibold text-slate-700 mb-1">Ora preferată</span>


                                    <input type="time" step="60"
                                    x-model="combined" @input="sync()" @change="sync()"
                                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                                    outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100">

                                    <!-- ascunse: se trimit în formular ca doua câmpuri separate -->
                                    <input type="hidden" x-ref="h" th:field="*{oraProgramare}">
                                    <input type="hidden" x-ref="m" th:field="*{minutProgramare}">
                                </label>
                            </div>

                            <label class="block">
                                <span class="block text-xs font-semibold text-slate-700 mb-1">Observații</span>
                                <textarea th:field="*{observatii}" rows="3"
                                          class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm
                              outline-none focus:bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-100"
                                          placeholder="Detalii suplimentare (ex: simptome, preferințe, etc.)"></textarea>
                            </label>
                        </div>
                    </fieldset>

                </div>

                <div class="grid lg:grid-cols-[1fr_auto] gap-6 items-start">
                    <p class="text-slate-600">
                        Notă: data selectată poate să nu fie disponibilă. Vei fi contactat pentru confirmare.
                    </p>

                    <div class="flex items-center gap-3">
                        <button type="submit"
                                class="inline-flex items-center gap-2 rounded-xl bg-orange-500 px-6 py-3
                    font-semibold text-white shadow-sm hover:bg-orange-600">
                            Trimite
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14"/><path d="M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>
        </div>

    </div>
</section>
</body>
</html>
