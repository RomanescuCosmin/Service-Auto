<!DOCTYPE html>
<html lang="ro" th:replace="~{fragments/layout :: layout(~{::title}, ~{::section})}"
      xmlns:x-transition="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Programările mele</title>
</head>

<body class="bg-slate-50">
<section x-data="{ showContent:false }"
         x-init="setTimeout(()=>showContent=true,120)"
         class="relative min-h-screen bg-slate-50">


    <div x-show="showContent"
         x-transition:enter="transition ease-out duration-700"
         x-transition:enter-start="opacity-0 translate-y-3"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="relative">

        <header class="w-full px-4 sm:px-6 lg:px-10 pt-8">
            <div class="bg-white">

                <div class="px-6 py-5 border-b border-slate-200">
                    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">

                        <div class="min-w-0">
                            <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">
                                Programările mele
                            </p>

                            <h1 class="mt-1 text-xl font-semibold text-slate-900">
                                Panou client · Service Auto
                            </h1>

                            <p class="mt-1 text-sm text-slate-600">
                                Urmărește programările, statusul și documentele.
                            </p>

                            <div class="mt-3 flex flex-wrap gap-2">
                        <span class="inline-flex items-center gap-1.5 rounded-full
                                     bg-emerald-100 text-emerald-800 border border-emerald-300
                                     px-2.5 py-1 text-xs font-semibold">
                            <span class="h-1.5 w-1.5 rounded-full bg-emerald-600"></span>
                            Confirmată
                        </span>

                                <span class="inline-flex items-center gap-1.5 rounded-full
                                     bg-amber-100 text-amber-900 border border-amber-300
                                     px-2.5 py-1 text-xs font-semibold">
                            <span class="h-1.5 w-1.5 rounded-full bg-amber-600"></span>
                            În așteptare
                        </span>

                                <span class="inline-flex items-center gap-1.5 rounded-full
                                     bg-rose-100 text-rose-800 border border-rose-300
                                     px-2.5 py-1 text-xs font-semibold">
                            <span class="h-1.5 w-1.5 rounded-full bg-rose-600"></span>
                            Anulată
                        </span>
                            </div>
                        </div>

                        <div class="flex items-center gap-6 shrink-0">
                            <div class="text-right">
                                <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">
                                    Total
                                </p>
                                <p class="text-2xl font-semibold text-slate-900"
                                   th:text="${programareList.size()}">
                                    0
                                </p>
                                <p class="text-xs text-slate-500">
                                    Programări
                                </p>
                            </div>

                            <div class="flex gap-2">
                                <a th:href="@{/programare}"
                                   class="inline-flex items-center gap-2
                                  rounded-md bg-slate-900 px-4 py-2
                                  text-sm font-semibold text-white
                                  hover:bg-slate-800">
                                    Programează
                                </a>

                                <a th:href="@{/contact}"
                                   class="inline-flex items-center gap-2
                                  rounded-md border border-slate-300
                                  bg-white px-4 py-2
                                  text-sm font-semibold text-slate-700
                                  hover:bg-slate-50">
                                    Contact
                                </a>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="px-6 py-4 bg-slate-50">
                    <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">

                        <div class="flex flex-col gap-2 sm:flex-row sm:items-center">

                            <div class="relative w-full sm:w-[320px]">
                                <svg class="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="7"/>
                                    <path d="M21 21l-4.3-4.3"/>
                                </svg>
                                <input type="text"
                                       placeholder="Caută după client, mașină, document..."
                                       class="w-full rounded-md border border-slate-300
                                      bg-white py-2 pl-9 pr-3
                                      text-sm text-slate-900
                                      placeholder:text-slate-400
                                      focus:border-slate-400 focus:outline-none"/>
                            </div>

                            <div class="flex flex-wrap gap-2">

                                <!-- TOATE -->
                                <a th:href="@{/programari-personale(
            page=1,
            size=${page.size},
            sort=${filter.sort},
            order=${filter.order}
        )}"
                                   class="rounded-md border px-3 py-2 text-sm font-semibold
              text-slate-700 hover:bg-slate-100"
                                   th:classappend="${filter.confirmed == null and filter.canceled == null}
            ? ' bg-slate-200'">
                                    Toate
                                </a>

                                <!-- CONFIRMATE -->
                                <a th:href="@{/programari-personale(
            page=1,
            size=${page.size},
            sort=${filter.sort},
            order=${filter.order},
            confirmed=true
        )}"
                                   class="rounded-md border border-emerald-300 px-3 py-2 text-sm font-semibold
              text-emerald-800 hover:bg-emerald-100"
                                   th:classappend="${filter.confirmed == true}
            ? ' bg-emerald-100'">
                                    Confirmate
                                </a>

                                <!-- ÎN AȘTEPTARE -->
                                <a th:href="@{/programari-personale(
            page=1,
            size=${page.size},
            sort=${filter.sort},
            order=${filter.order},
            confirmed=false,
            canceled=false
        )}"
                                   class="rounded-md border border-amber-300 px-3 py-2 text-sm font-semibold
              text-amber-900 hover:bg-amber-100"
                                   th:classappend="${filter.confirmed == false and filter.canceled == false}
            ? ' bg-amber-100'">
                                    În așteptare
                                </a>

                                <!-- ANULATE -->
                                <a th:href="@{/programari-personale(
            page=1,
            size=${page.size},
            sort=${filter.sort},
            order=${filter.order},
            canceled=true
        )}"
                                   class="rounded-md border border-rose-300 px-3 py-2 text-sm font-semibold
              text-rose-800 hover:bg-rose-100"
                                   th:classappend="${filter.canceled == true}
            ? ' bg-rose-100'">
                                    Anulate
                                </a>

                            </div>

                        </div>

                        <div class="flex items-center gap-2">
                            <span class="text-xs font-semibold text-slate-500">Sortare:</span>
                            <button class="rounded-md border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">
                                Dată (crescător)
                            </button>
                        </div>

                    </div>
                </div>

            </div>

            <!-- alerte -->
            <div th:replace="~{fragments/succes-message}"></div>
            <div th:replace="~{fragments/notification-error}"></div>

        </header>


        <div class="mt-8 px-4 sm:px-6 lg:px-10">
            <div class="relative">
                <div class="pointer-events-none absolute left-4 top-0 hidden h-full w-px bg-slate-200 sm:block"></div>

                <div th:each="programare : ${programareList}"
                     class="relative mb-8 pl-0 sm:pl-12">
                    <div class="hidden sm:flex absolute left-0 top-6 h-8 w-8 items-center justify-center rounded-full border border-slate-200 bg-white shadow-sm">
                        <span class="h-2.5 w-2.5 rounded-full"
                              th:classappend="
                                  ${programare.confirmed() == true} ? 'bg-emerald-500' :
                                  (${programare.canceled() == true} ? 'bg-rose-500' : 'bg-amber-500')">
                        </span>
                    </div>

                    <div class="flex flex-col gap-4 rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm backdrop-blur lg:flex-row lg:items-start lg:justify-between">
                        <div class="flex flex-col gap-4 lg:flex-row lg:gap-10">
                            <div class="flex flex-col gap-1">
                                <p class="text-xs uppercase tracking-wide text-slate-400">Programare</p>
                                <p class="text-lg font-semibold text-slate-900"
                                   th:text="${#temporals.format(programare.dataProgramare, 'dd MMM yyyy')}"></p>
                                <p class="text-sm font-medium text-slate-600"
                                   th:text="|${#numbers.formatInteger(programare.oraProgramare,2)}:${#numbers.formatInteger(programare.minutProgramare,2)}|"></p>
                            </div>

                            <div class="min-w-0">
                                <p class="text-xs uppercase tracking-wide text-slate-400">Client</p>
                                <p class="text-base font-semibold text-slate-900 truncate"
                                   th:text="${programare.nume()}"></p>
                                <p class="mt-2 text-xs uppercase tracking-wide text-slate-400">Mașină</p>
                                <p class="text-sm text-slate-700 truncate">
                                    <span th:text="${programare.marcaNume()}"></span>
                                    <span th:text="${programare.modelNume()}"></span>
                                </p>
                            </div>

                            <div class="min-w-0">
                                <p class="text-xs uppercase tracking-wide text-slate-400">Document</p>
                                <p th:if="${programare.fileStorageId() != null}"
                                   class="text-sm text-slate-700 truncate"
                                   th:title="${programare.fileOriginalName}"
                                   th:text="${programare.fileOriginalName}"></p>
                                <p th:unless="${programare.fileOriginalName() != null}"
                                   class="text-sm italic text-slate-400">
                                    Fără document
                                </p>
                            </div>
                        </div>

                        <div class="flex flex-col gap-4 sm:flex-row sm:items-center lg:flex-col lg:items-end">
                            <span class="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold"
                                  th:classappend="
                                      ${programare.confirmed() == true} ? 'bg-emerald-100 text-emerald-800 border-emerald-300' :
                                      (${programare.canceled() == true} ? 'bg-rose-100 text-rose-800 border-rose-300' :
                                      'bg-amber-100 text-amber-900 border-amber-300')">
                                <span class="h-2 w-2 rounded-full"
                                      th:classappend="
                                          ${programare.confirmed() == true} ? 'bg-emerald-600' :
                                          (${programare.canceled() == true} ? 'bg-rose-600' : 'bg-amber-600')">
                                </span>
                                <span th:text="
                                      ${programare.confirmed() == true} ? 'Confirmată' :
                                      (${programare.canceled() == true} ? 'Anulată' : 'În așteptare')">
                                </span>
                            </span>

                            <div class="flex gap-2">
                                <a th:if="${programare.fileStorageId() != null}"
                                   th:href="@{|/files/${programare.fileStorageId()}|}"
                                   class="px-3 py-1.5 text-[11px] font-semibold uppercase
                                  rounded-full border border-slate-300
                                  text-slate-700 hover:bg-slate-100 transition">
                                    Descarcă
                                </a>

                                <button th:if="${!programare.canceled}"
                                        th:attr="onclick=|openModal('cancelModal-${programare.id}')|"
                                        class="px-3 py-1.5 text-[11px] font-semibold uppercase
                                       rounded-full bg-red-600 text-white
                                       hover:bg-red-700 transition">
                                    Anulează
                                </button>
                            </div>
                        </div>
                    </div>

                    <div th:replace="~{fragments/anulare-programare :: anulare-programare(${programare.id})}"></div>
                </div>
            </div>
        </div>

        <div class="mt-6 flex flex-col gap-4 px-6 sm:flex-row sm:items-center sm:justify-between">
            <div class="text-sm text-slate-500">
                Pagina <span class="font-semibold text-slate-700" th:text="${page.page}"></span>
                din <span class="font-semibold text-slate-700" th:text="${page.totalPages()}"></span>
            </div>

            <div class="flex items-center gap-3 rounded-full border border-slate-200 bg-white px-2 py-1 shadow-sm">
                <a th:if="${page.page > 1}"
                   th:href="@{/programari-personale(
               page=${page.page - 1},
               size=${page.size},
               sort=${filter.sort},
               order=${filter.order}
           )}"
                   class="group inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">
                    <span class="text-base">‹</span>
                    Înapoi
                </a>

                <div class="hidden h-6 w-px bg-slate-200 sm:block"></div>

                <span class="rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white">
                    Pagina <span th:text="${page.page}"></span>
                </span>

                <div class="hidden h-6 w-px bg-slate-200 sm:block"></div>

                <a th:if="${page.page < page.totalPages()}"
                   th:href="@{/programari-personale(
               page=${page.page + 1},
               size=${page.size},
               sort=${filter.sort},
               order=${filter.order}
           )}"
                   class="group inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">
                    Înainte
                    <span class="text-base">›</span>
                </a>
            </div>
        </div>
    </div>
</section>
</body>
</html>
